-- name: CreateVulnerabilityReportsTable :exec
CREATE TABLE IF NOT EXISTS vulnerabilityreports (
    id bigint GENERATED ALWAYS AS IDENTITY,
    name VARCHAR(253) NOT NULL,
    namespace VARCHAR(253) NOT NULL,
    object TEXT NOT NULL,
    UNIQUE(name, namespace)
);

-- name: CreateVulnerabilityReport :execresult
INSERT INTO vulnerabilityreports (
  name, namespace, object
) VALUES (
  $1, $2, $3
)
ON CONFLICT DO NOTHING;

-- name: DeleteVulnerabilityReport :one
DELETE FROM vulnerabilityreports
WHERE name = $1 AND namespace = $2
RETURNING *;

-- name: GetVulnerabilityReport :one
SELECT * FROM vulnerabilityreports
WHERE name = $1 AND namespace = $2;

-- name: ListVulnerabilityReportByNamespace :many
SELECT * FROM vulnerabilityreports WHERE namespace = $1;

-- name: ListVulnerabilityReport :many
SELECT * FROM vulnerabilityreports;

-- name: UpdateVulnerabilityReport :exec
UPDATE vulnerabilityreports
SET object = $1
WHERE name = $2 AND namespace = $3;

-- name: CountVulnerabilityReportByNamespace :one
SELECT COUNT(*) FROM vulnerabilityreports WHERE namespace = $1;

-- name: CountVulnerabilityReport :one
SELECT COUNT(*) FROM vulnerabilityreports;
